<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Library - Yobble</title>
<link rel="stylesheet" href="/style.css">
<style>
  :root{
    --lib-bg:#0a0d12;
    --lib-ink:#eef2ff;
    --lib-muted:#a5b0c6;
    --lib-card:#141a24;
    --lib-border:#283043;
    --lib-accent:#ffd166;
    --lib-accent-2:#4dd4ff;
  }
  body{
    background:radial-gradient(circle at 15% 20%,rgba(77,212,255,.18),transparent 40%),
               radial-gradient(circle at 85% 10%,rgba(255,209,102,.16),transparent 45%),
               var(--lib-bg);
    color:var(--lib-ink);
    font-family:"Space Grotesk","IBM Plex Sans","Segoe UI",sans-serif;
  }
  main{max-width:1200px}
  .lib-wrap{display:flex;flex-direction:column;gap:18px}
  .hero{
    display:grid;
    grid-template-columns:1.2fr .8fr;
    gap:20px;
    padding:20px;
    position:relative;
    overflow:hidden;
  }
  .hero::before{
    content:"";
    position:absolute;
    inset:0;
    background:linear-gradient(120deg,rgba(255,209,102,.16),transparent 35%),
               linear-gradient(240deg,rgba(77,212,255,.12),transparent 40%);
    pointer-events:none;
  }
  .hero h1{margin:0 0 8px;font-size:38px}
  .hero p{margin:0;color:var(--lib-muted)}
  .pill{
    border:1px solid var(--lib-border);
    border-radius:999px;
    padding:6px 12px;
    font-size:12px;
    color:var(--lib-muted);
    background:rgba(20,26,36,.6);
  }
  .hero-art{
    border-radius:16px;
    border:1px solid var(--lib-border);
    min-height:160px;
    background:
      linear-gradient(130deg,rgba(255,209,102,.25),rgba(20,26,36,.45)),
      repeating-linear-gradient(45deg,rgba(255,255,255,.05) 0 10px,transparent 10px 20px);
    display:flex;
    align-items:flex-end;
    padding:16px;
    font-weight:600;
  }
  .controls{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }
  .controls input{
    border:1px solid var(--lib-border);
    background:#0c1118;
    color:var(--lib-ink);
    padding:10px 12px;
    border-radius:10px;
    font-family:inherit;
    min-width:220px;
  }
  .controls select{
    border:1px solid var(--lib-border);
    background:#0c1118;
    color:var(--lib-ink);
    padding:10px 12px;
    border-radius:10px;
    font-family:inherit;
  }
  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
    gap:16px;
  }
  .card{
    background:var(--lib-card);
    border:1px solid var(--lib-border);
    border-radius:16px;
    padding:16px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .game-title{font-size:18px;font-weight:700}
  .game-meta{color:var(--lib-muted);font-size:12px}
  .game-desc{color:var(--lib-muted);font-size:13px;line-height:1.4}
  .game-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:auto}
  .btn{
    border:1px solid var(--lib-border);
    background:transparent;
    color:var(--lib-ink);
    padding:8px 12px;
    border-radius:10px;
    text-decoration:none;
    font-size:12px;
  }
  .btn.primary{
    background:linear-gradient(120deg,var(--lib-accent),#ffb84a);
    border:none;
    color:#201a08;
    font-weight:700;
  }
  .empty{
    border:1px dashed var(--lib-border);
    border-radius:16px;
    padding:20px;
    color:var(--lib-muted);
  }
  @media (max-width: 900px){
    .hero{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<main class="lib-wrap">
  <section class="card hero">
    <div>
      <div class="pill">Library</div>
      <h1>Your saved games</h1>
      <p>Keep your favorites close and jump back into them anytime.</p>
      <div class="controls" style="margin-top:14px">
        <input id="searchInput" placeholder="Search your library">
        <select id="sortSelect">
          <option value="recent">Recently added</option>
          <option value="title">Title Aâ€“Z</option>
        </select>
      </div>
    </div>
    <div class="hero-art">Quick launch</div>
  </section>

  <section class="grid" id="libraryGrid"></section>
  <section class="empty" id="libraryEmpty" hidden>No games saved yet.</section>
</main>
<script type="module">
import { mountTopbar } from "/js/layout.js";
import { api } from "/js/api.js";

await mountTopbar("library");

const grid = document.getElementById("libraryGrid");
const empty = document.getElementById("libraryEmpty");
const searchInput = document.getElementById("searchInput");
const sortSelect = document.getElementById("sortSelect");

let library = [];

function renderList(items){
  grid.innerHTML = "";
  if (!items.length) {
    empty.hidden = false;
    return;
  }
  empty.hidden = true;
  for (const game of items) {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="game-title">${escapeHtml(game.title || "Untitled")}</div>
      <div class="game-meta">${game.category ? escapeHtml(game.category) : "Uncategorized"}</div>
      <div class="game-desc">${escapeHtml(game.description || "No description yet.")}</div>
      <div class="game-actions">
        <a class="btn primary" href="/games/${encodeURIComponent(game.slug)}">Play</a>
        <a class="btn" href="/game.html?slug=${encodeURIComponent(game.slug)}">Details</a>
      </div>
    `;
    grid.appendChild(card);
  }
}

function escapeHtml(value){
  return String(value || "").replace(/[&<>"']/g, (ch) => ({
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    "\"": "&quot;",
    "'": "&#39;"
  }[ch]));
}

function applyFilters(){
  const q = searchInput.value.trim().toLowerCase();
  let items = library.slice();
  if (q) {
    items = items.filter(g =>
      String(g.title || "").toLowerCase().includes(q) ||
      String(g.description || "").toLowerCase().includes(q)
    );
  }
  if (sortSelect.value === "title") {
    items.sort((a, b) => String(a.title || "").localeCompare(String(b.title || "")));
  } else {
    items.sort((a, b) => (b.added_at || 0) - (a.added_at || 0));
  }
  renderList(items);
}

async function loadLibrary(){
  try{
    const res = await api.get("/api/library");
    library = res.games || [];
  }catch{
    library = [];
  }
  applyFilters();
}

searchInput.addEventListener("input", applyFilters);
sortSelect.addEventListener("change", applyFilters);

await loadLibrary();
</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Terms of Service - Yobble</title>
<link rel="stylesheet" href="/style.css">
<style>
  :root{
    --tos-bg:#0a0d12;
    --tos-ink:#f2f4ff;
    --tos-muted:#a9b2c6;
    --tos-card:#151c27;
    --tos-border:#273246;
    --tos-accent:#ffb703;
    --tos-accent-2:#00c2ff;
  }
  body{
    background:
      radial-gradient(circle at 12% 12%,rgba(255,183,3,.18),transparent 42%),
      radial-gradient(circle at 82% 8%,rgba(0,194,255,.14),transparent 45%),
      linear-gradient(180deg,rgba(10,13,18,.9),rgba(8,10,14,.96)),
      var(--tos-bg);
    color:var(--tos-ink);
    font-family:"Space Grotesk","IBM Plex Sans","Segoe UI",sans-serif;
  }
  main{max-width:1000px;margin:0 auto;padding:32px 20px 60px}
  .hero{
    position:relative;
    overflow:hidden;
    border-radius:20px;
    border:1px solid var(--tos-border);
    padding:24px;
    background:linear-gradient(130deg,rgba(255,183,3,.16),rgba(21,28,39,.65));
  }
  .hero::after{
    content:"";
    position:absolute;
    inset:0;
    background:linear-gradient(140deg,rgba(0,194,255,.12),transparent 50%);
    pointer-events:none;
  }
  .hero h1{margin:0 0 8px;font-size:38px;letter-spacing:.4px}
  .hero p{margin:0;color:var(--tos-muted);max-width:720px}
  .hero-meta{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
  .pill{
    border:1px solid var(--tos-border);
    border-radius:999px;
    padding:6px 12px;
    font-size:12px;
    color:var(--tos-muted);
    background:rgba(21,28,39,.7);
  }
  .pill.accent{
    border-color:rgba(255,183,3,.5);
    color:#1b1408;
    background:var(--tos-accent);
    font-weight:700;
  }
  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:16px;
    margin-top:18px;
  }
  .card{
    background:var(--tos-card);
    border:1px solid var(--tos-border);
    border-radius:16px;
    padding:16px;
    animation:rise .45s ease both;
  }
  .card h2{
    margin:0 0 8px;
    font-size:18px;
  }
  .card p{margin:0;color:var(--tos-muted)}
  .section{
    margin-top:18px;
    background:var(--tos-card);
    border:1px solid var(--tos-border);
    border-radius:18px;
    padding:20px;
    animation:rise .45s ease both;
  }
  .section h2{margin:0 0 10px;font-size:22px}
  .section h3{margin:16px 0 6px;font-size:16px}
  .section p{margin:0;color:var(--tos-muted)}
  .section ul{margin:8px 0 0 18px;color:var(--tos-muted)}
  .section li{margin:6px 0}
  .callout{
    display:flex;
    gap:12px;
    align-items:flex-start;
    background:linear-gradient(130deg,rgba(0,194,255,.12),rgba(21,28,39,.8));
    border:1px solid rgba(0,194,255,.3);
    border-radius:16px;
    padding:16px;
    margin-top:18px;
  }
  .callout strong{color:var(--tos-ink)}
  .toc{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
  .toc a{
    border:1px solid var(--tos-border);
    border-radius:999px;
    padding:6px 12px;
    font-size:12px;
    color:var(--tos-muted);
    background:rgba(21,28,39,.65);
  }
  @keyframes rise{
    from{opacity:0;transform:translateY(8px)}
    to{opacity:1;transform:translateY(0)}
  }
  @media (max-width: 720px){
    main{padding:24px 16px 50px}
    .hero h1{font-size:30px}
  }
</style>
</head>
<body>
<main id="tosContent"></main>
<script type="module">
import { mountTopbar } from "/js/layout.js";
await mountTopbar("tos");
const tosContent = document.getElementById("tosContent");

function escapeHtml(value){
  return String(value || "").replace(/[&<>\"']/g, (ch) => ({
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    "\"": "&quot;",
    "'": "&#39;"
  }[ch]));
}

function renderParagraphs(paragraphs){
  if (!Array.isArray(paragraphs)) return "";
  return paragraphs.map(p => `<p>${escapeHtml(p)}</p>`).join("");
}

function renderBullets(bullets){
  if (!Array.isArray(bullets) || !bullets.length) return "";
  return `<ul>${bullets.map(b => `<li>${escapeHtml(b)}</li>`).join("")}</ul>`;
}

function renderSubsections(subsections){
  if (!Array.isArray(subsections)) return "";
  return subsections.map(s => `
    <h3>${escapeHtml(s.title || "")}</h3>
    ${renderParagraphs(s.paragraphs)}
    ${renderBullets(s.bullets)}
  `).join("");
}

function renderTos(data){
  const meta = Array.isArray(data.meta) ? data.meta : [];
  const sections = Array.isArray(data.sections) ? data.sections : [];
  const highlights = Array.isArray(data.highlights) ? data.highlights : [];
  const updated = data.updated ? `Last updated ${escapeHtml(data.updated)}` : "Last updated";
  const contact = data.contact ? `Contact: ${escapeHtml(data.contact)}` : "Contact";

  const toc = sections
    .filter(s => s && s.id && s.title)
    .map(s => `<a href="#${escapeHtml(s.id)}">${escapeHtml(s.title)}</a>`)
    .join("");

  const highlightCards = highlights.map(h => `
    <div class="card">
      <h2>${escapeHtml(h.title || "")}</h2>
      <p>${escapeHtml(h.text || "")}</p>
    </div>
  `).join("");

  const sectionBlocks = sections.map(s => `
    <section class="section" id="${escapeHtml(s.id || "")}">
      <h2>${escapeHtml(s.title || "")}</h2>
      ${renderParagraphs(s.paragraphs)}
      ${renderBullets(s.bullets)}
      ${renderSubsections(s.subsections)}
    </section>
  `).join("");

  tosContent.innerHTML = `
    <section class="hero">
      <h1>${escapeHtml(data.title || "Terms of Service")}</h1>
      <p>${escapeHtml(data.intro || "")}</p>
      <div class="hero-meta">
        <span class="pill accent">${updated}</span>
        ${meta.map(m => `<span class="pill">${escapeHtml(m)}</span>`).join("")}
        <span class="pill">${contact}</span>
      </div>
      <div class="toc">${toc}</div>
    </section>
    <section class="grid">${highlightCards}</section>
    ${sectionBlocks}
    <section class="callout">
      <div>
        <strong>Questions?</strong>
        <div class="pill" style="margin-top:8px">${escapeHtml(data.contact || "")}</div>
      </div>
    </section>
  `;
}

try{
  const res = await fetch("/tos.json", { cache: "no-store" });
  if (!res.ok) throw new Error("Failed to load");
  renderTos(await res.json());
}catch{
  tosContent.innerHTML = `
    <section class="section">
      <h2>Terms unavailable</h2>
      <p>We could not load the Terms of Service content right now. Please try again later.</p>
    </section>
  `;
}
</script>
</body>
</html>

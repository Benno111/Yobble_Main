#!/usr/bin/env bash
set -e

WEB_DIR="web"

echo "âž• Injecting /js/layout.js into HTML files in $WEB_DIR"
echo "ðŸ“¦ Backups will be created as .bak files"
echo

shopt -s globstar

for file in "$WEB_DIR"/**/*.html; do
  [ -f "$file" ] || continue

  base="$(basename "$file")"

  # Skip auth pages
  if [[ "$base" == "login.html" || "$base" == "register.html" ]]; then
    echo "â†· Skipping auth page: $file"
    continue
  fi

  # Skip if already injected
  if grep -q '/js/layout.js' "$file"; then
    echo "âœ“ Already has layout: $file"
    continue
  fi

  echo "â†’ Updating $file"
  cp "$file" "$file.bak"

  # Inject before closing </body>
  sed -i '
    /<\/body>/i \
<script type="module">\
  import { loadLayout } from "/js/layout.js";\
  loadLayout();\
</script>
  ' "$file"

done

echo
echo "âœ… Layout loader added to all applicable HTML files."
echo "â†© Restore with: mv file.html.bak file.html"

